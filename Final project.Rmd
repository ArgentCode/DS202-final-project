---
title: "Final"
author: "Ngoc Nguyen, Craig Orman"
date: "4/29/2022"
output: html_document
---

```{r, knitr, setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Selection
This is how we selected our data and ensured it would be small enough to go on github.
```{r, DataSelection, eval = FALSE, echo = FALSE}
HousingOriginal <- read.csv("properties_small_2017.csv")
smallData = HousingOriginal %>% select(yearbuilt, bathroomcnt, airconditioningtypeid, regionidcity, fireplacecnt,
                                       basementsqft, finishedsquarefeet15, landtaxvaluedollarcnt, typeconstructiontypeid, garagetotalsqft,
                                       latitude, longitude, taxvaluedollarcnt)
smallData = smallData %>% filter(bathroomcnt > 0, taxvaluedollarcnt > 999)
samllSampledData = sample_n(smallData, 1000000)
write.csv(samllSampledData,"C:\\Users\\black\\Desktop\\School\\DS 202\\DS202-final-project\\properties_small_2017.csv", row.names = FALSE)
```

## Instantiation
```{r, Instantiation}
library(tidyverse)
library(ggmosaic)
library(maps)
library(ggplot2)
library(dplyr)
library(broom)
library(ggpubr)
HousingOriginal <- read.csv("properties_small_2017.csv")
```
## Proposal (Homework 11)

Data was acquired from a 2017 kaggle competition, [Zillow Prize: Zillowâ€™s Home Value Prediction (Zestimate)](https://www.kaggle.com/competitions/zillow-prize-1). We specifically used the properties_2017.csv

Project is on [Github](https://github.com/ArgentCode/DS202-final-project).

Our plan is to use the taxvaluedollarcnt as the actual value of the house, and we plan on doing a variety of visualizations and assessments on both the explanatory variables and the response variable. We will be coming at this with a statistics approach as if we were preparing to make a model. We also hope to do a map to visualize the data and see what we can do for that style of visual with coloring and making interesting visuals.

We noticed the data is decently well cleaned. We suspect dealing with the large number of NA's will be a major challenge, but most of the cleaning has occured in the form of reducing. The original data was an almost 700 mb csv file we had to shrink down (Code above on methodology).

## Actual Report

Real estate and Housing prices are always in great flux. We have decided to use the 2017 Zillow competition data to try and predict prices for real estate using a variety of factors. The response variable we are using will be taxvaluedollarcnt. A continuous quantitative variable. 
The response variables are:
Quantitative: 
yearbuilt, discrete
bathroomcnt, discrete with halves
fireplacecnt, discrete
basementsqft, continuous
finishedsquarefeet15, continuous
landtaxvaluedollarcnt, continuous
garagetotalsqft, continuous

Categorical:
airconditioningtypeid, nominal
regionidcity, nominal
typeconstructiontypeid, nominal

## Clean and visualize

First, how many NA's do we have.
```{r}
colSums(is.na(HousingOriginal))
```
The variables airconditioningtypeid, fireplacecnt, basementsqft, finishedsquarefeet15, typeconstructiontypeid, garagetotalsqft all have a large majority of null values. fireplacecnt uses null to indicate that there is no fireplace. basementsqft uses null to indicate that some houses do not have basement (most of the houses in CA do not) and some basements haven't finished. However, garagetotalsqft and airconditioningtypeid have a category for no air conditioner so there is no obvious explanation for the lack of values. One possibility is those houses hasn't finished the garage and AC yet.  We still have ~300,000 observations so analysis should be able to continue.

Response Variable:
The response variable is our first investigation, we will be attempting to see if it is bell shaped and has a normal distribution. We see the data is quite spread out, with a standard deviation of $614,453 and a mean of $441,428. There are 103,994 observations of houses less than $100,000 and 443 observations of houses more than $10,000,000. So our data is incredibly spread out. 
```{r, ResponseVariable}
HousingOriginal %>% ggplot(aes(x=taxvaluedollarcnt)) + geom_histogram()
HousingOriginal$taxvaluedollarcnt %>% summary() 
mean(HousingOriginal$taxvaluedollarcnt)
sd(HousingOriginal$taxvaluedollarcnt)
HousingOriginal[HousingOriginal$taxvaluedollarcnt > 10000000, ] %>% count()
HousingOriginal[HousingOriginal$taxvaluedollarcnt < 100000, ] %>% count()
```
Quantitative Explanatory Variables:
```{r, QuantitativeExplanatoryVariables}
HousingOriginal %>% ggplot(aes(x=yearbuilt)) + geom_boxplot()
HousingOriginal %>% 
ggplot(aes(x=yearbuilt))+geom_line(stat="density", color="Red", size=1)+theme_bw()
# Most houses were built around 1950-1955, not so many houses neither before 1920 nor after 2000 were analyzed 
HousingOriginal %>% ggplot(aes(x=bathroomcnt)) + geom_histogram()

HousingOriginal %>% 
ggplot(aes(x=bathroomcnt))+geom_line(stat="density", color="Red", size=1)+theme_bw()

HousingOriginal %>% ggplot(aes(x=fireplacecnt)) + geom_histogram()

HousingOriginal %>% 
ggplot(aes(x=fireplacecnt))+geom_line(stat="density", color="Red", size=1)+theme_bw()

HousingOriginal %>% ggplot(aes(x=basementsqft)) + geom_boxplot()

HousingOriginal %>% 
ggplot(aes(x=basementsqft))+geom_line(stat="density", color="Red", size=1)+theme_bw()

HousingOriginal %>% ggplot(aes(x=finishedsquarefeet15)) + geom_boxplot()

HousingOriginal %>% 
ggplot(aes(x=finishedsquarefeet15))+geom_line(stat="density", color="Red", size=1)+theme_bw()

HousingOriginal %>% ggplot(aes(x=landtaxvaluedollarcnt)) + geom_boxplot()

HousingOriginal %>% 
ggplot(aes(x=landtaxvaluedollarcnt))+geom_line(stat="density", color="Red", size=1)+theme_bw()

HousingOriginal %>% ggplot(aes(x=garagetotalsqft)) + geom_boxplot()
HousingOriginal %>% 
ggplot(aes(x=garagetotalsqft))+geom_line(stat="density", color="Red", size=1)+theme_bw()
```
 

YearBuilt is mostly older houses, I was expecting older houses but the median house age is considerably lower than I anticipated. landtaxvaluedollarcnt has a strange distribution I think warrants further investigation we will do later.

Categorical Explanatory Variables:
```{r, CategoricalExplanatoryVariables}
HousingOriginal %>% ggplot(aes(x=airconditioningtypeid)) + geom_bar()
HousingOriginal %>% ggplot(aes(x=regionidcity)) + geom_histogram()
HousingOriginal %>% ggplot(aes(x=typeconstructiontypeid)) + geom_bar()
``` 

It appears the most common air conditioning type is Central, followed by "Yes". No further explanation is give for "Yes". Most of the observations are from one city, and most of the construction types are Custom. 

Next, to get a general sense of what data we are talking about, we will map out the data on a plot. Zillow multiplied all longitudes and latitudes by 1*10e^6 so we accounted for this in the code.
```{r, MapData}
states <- map_data("state")
filter(states, region == "california") %>% ggplot(aes(x = long, y = lat)) +
  geom_path(aes(group = group)) +
  geom_point(data=HousingOriginal,aes(x=longitude/1000000, y=latitude/1000000, color="#E69F00")) +
  ggtitle("All data mapped against California")
```

### We each should do one of each of these
+ Numeric vs numberic ( using scatterplots) 
+ Numeric vs categorical ( using side by side boxplots or facetted plot)
+ Categorical vs categorical ( using barchart with facetting or other aesthetic)

### Craig's Questions:
Variables: yearBuilt, bathroomcnt, airconditioningtypeid, regionIDCity, fireplacecnt
<!-- numeric vs numeric -->
1. What is the relationship between bathroomcnt and fireplacecnt 
<!-- numeric vs categorical -->
2. What is the relationship between yearbuilt and airconditioningtypeid
<!-- categorical vs categorical -->

In modern architecture, fire places are not very common place, but do exist especially in nicer homes. In older architecture, they are more common for both stylistic and actual warmth purposes.
```{r, BathFire}
CraigsHousing = HousingOriginal
#fireplacecnt had to have nas replaced with 0s for the plot
CraigsHousing$fireplacecnt = CraigsHousing$fireplacecnt %>% replace_na(0)
CraigsHousing[CraigsHousing$bathroomcnt > 10, ] %>% count()
CraigsHousing[CraigsHousing$bathroomcnt < CraigsHousing$fireplacecnt, ] %>% count()
CraigsHousing %>% ggplot(aes(x=bathroomcnt, y=fireplacecnt)) + geom_point()
cor(CraigsHousing$bathroomcnt, CraigsHousing$fireplacecnt)
```

With an r value of 0.087 we know these values are independent. We can also see from the data that fireplaces are pretty scattered across all bathrooms quantities. Also, there are 237 homes with more than 10 bathrooms, and 672 homes that have more fireplaces than bathrooms both of which I found interesting.

Air conditioning is a rather recent invention compared to some of these houses. With that in mind, I am quite curious what air conditioning systems are most common for different eras
```{r yearlyAirConditioning}
CraigsHousing %>% ggplot(aes(y=yearbuilt)) + geom_boxplot() + facet_grid(~airconditioningtypeid)
filter(CraigsHousing, airconditioningtypeid > 0) %>%
  ggplot(aes(y=taxvaluedollarcnt,
             x=yearbuilt,
             color=as.factor(airconditioningtypeid))) +
  geom_point()
```
1 Central, 3 Evaporative Cooler, 5 None, 9 Refrigeration, 11 Wall Unit, 12 Window Unit, 13 Yes
I have no idea what an evaporative cooler is but, they apparently existed very briefly. A lot more houses don't have air conditioning than I thought would. I also didn't expect central air in so many old houses. The comparison 

We will also explore the relationship between fireplacecnt and yearbuilt. As houses get newer, I believe they have less fireplaces.
```{r}
CraigsHousing.byYear = CraigsHousing %>% group_by(yearbuilt) %>%
  summarize(
    m.fireplacecnt = mean(fireplacecnt, na.rm=TRUE)
  )
CraigsHousing.byYear %>% ggplot(aes(x=yearbuilt, y=m.fireplacecnt)) + geom_line()
``` 
### Ngoc's Questions:
Ngoc's variables: basementsqft, finishedsquarefeet15, landtaxvaluedollarcnt, typeconstructiontypeid, garagetotalsqft

### Linear regression
Now we will attempt a linear regression. In theory we should do variable selection and test p-values and such. Instead I am going to use yearbuilt, bathroomcnt, and regionidcity. bathroomcnt I believe will act as "how big is the house", while yearbuilt determines age. These are the factors I will use to try and explain taxvaluedollarcnt.

First we check the explanatory variables against the response.
```{r}
regressionData = HousingOriginal %>% select(taxvaluedollarcnt, yearbuilt, bathroomcnt)
res <- cor(regressionData)
round(res, 2)

regressionData %>% ggplot(aes(x=taxvaluedollarcnt, y=yearbuilt)) + geom_point()
regressionData %>% ggplot(aes(x=taxvaluedollarcnt, y=bathroomcnt)) + geom_point()
```
bathroomcnt is moderately visually linear. Yearbuilt looks around moderately as well. 

Next, as practice, we will try a single regression investigating whether using only yearbuilt helps to explain taxvaluedollarcnt.
```{r}
single.regression <- lm(taxvaluedollarcnt ~ yearbuilt, data = regressionData)

summary(single.regression)
```
Does this model help to explain taxvaluedollarcnt?
Null hypothesis: b1 = 0
Alternative hypothesis: b1 != 0
f statistic: 2.456e+04
p value: <0.0001
Conclusion: we have overwhelimg evidence that using yearbuilt helps to explain the value of taxvaluedollarcnt in the sample.
Equation = -7.342e+06 + 3.962e+03*yearbuilt
adjusted R^2: 0.02399 This means that using yearbuilt we can explain 2.4% of the variance in taxvaluedollarcnt

With real estate being an interesting and dynamic market a single variable obviously wouldn't do very well. I was expecting it to perform better though. How about more variables?
```{r}
multiple.regression <- lm(taxvaluedollarcnt ~ yearbuilt + bathroomcnt, data = regressionData)

summary(multiple.regression)
```
Does this model help to explain taxvaluedollarcnt?
Null hypothesis: b1 = b2 = 0
Alternative hypothesis: atleast one of b1, b2 != 0
f statistic: 1.333e+05
p value: <0.0001
Conclusion: we have overwhelimg evidence that using yearbuilt and bathroomcnt help to explain the value of taxvaluedollarcnt in the sample.
Equation = 615,355.83 - 417.42 * yearbuilt + 280,238.92 * bathroomcnt
adjusted R^2: 0.2106 This means that using yearbuilt and bathroomcnt we can explain 21% of the variance in taxvaluedollarcnt

These results confuse me. $280k seems like a lot per bathoom, and as houses get newer I would think they get more valuable but that does not appear to be the case. Our R^2 is quite low, but raised dramatically from the single variable.